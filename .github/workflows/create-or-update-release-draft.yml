on:
  # run only on PRs merged to release/* or hotfix/* branches
  pull_request:
    types: [merged, closed]
    branches:
      - 'release/*'
      - 'hotfix/*'

jobs:
 update-release-draft:
   runs-on: ubuntu-latest
   steps:
      - name: Extract version
        id: extract_version
        run: |
          branch_name=${GITHUB_REF##*/}
          
          # Extract version using regex
          if [[ $branch_name =~ ^(hotfix|release)/v([0-9]+)\.([0-9]+)\.([0-9]+)$ ]]; then
            version="v${BASH_REMATCH[2]}.${BASH_REMATCH[3]}.${BASH_REMATCH[4]}"
            echo "Version: $version"
            echo "::set-output name=version::$version"
          else
            echo "Branch name does not match the expected pattern"
            exit 1
          fi

      - name: Display extracted version
        run: echo "Extracted version: ${{ steps.extract_version.outputs.version }}"


      - uses: release-drafter/release-drafter@v5
        name: Update or create release draft
        with:
          version: ${{ steps.extract_version.outputs.version }}"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}